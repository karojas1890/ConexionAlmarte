{% extends "layout_terapeuta.html" %}

{% block title %}Gesti√≥n de Encuesta{% endblock %}

{% block content %}  
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <h1>üìä Dashboard de Encuestas</h1>
        <p>Gesti√≥n y an√°lisis de encuestas de usabilidad</p>
    </div>

    <!-- Estad√≠sticas R√°pidas -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üìù</div>
            <div class="stat-info">
                <h3 id="total-encuestas">0</h3>
                <p>Total Encuestas</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-info">
                <h3 id="promedio-general">0.0</h3>
                <p>Puntuaci√≥n Promedio</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-info">
                <h3 id="total-pacientes">0</h3>
                <p>Pacientes</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üë®‚Äç‚öïÔ∏è</div>
            <div class="stat-info">
                <h3 id="total-terapeutas">0</h3>
                <p>Terapeutas</p>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="filters-section">
        <div class="filter-group">
            <label for="filtro-rol">Filtrar por Rol:</label>
            <select id="filtro-rol">
                <option value="todos">Todos los roles</option>
                <option value="paciente">Pacientes</option>
                <option value="terapeuta">Terapeutas</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="filtro-fecha">Filtrar por Fecha:</label>
            <select id="filtro-fecha">
                <option value="todos">Todas las fechas</option>
                <option value="7">√öltimos 7 d√≠as</option>
                <option value="30">√öltimos 30 d√≠as</option>
                <option value="90">√öltimos 3 meses</option>
            </select>
        </div>
        <button class="btn-primary" onclick="aplicarFiltros()">Aplicar Filtros</button>
        <button class="btn-secondary" onclick="exportarDatos()">üì• Exportar Datos</button>
    </div>

    <!-- Gr√°ficos -->
    <div class="charts-grid">
        <!-- Gr√°fico de Puntuaci√≥n por Secci√≥n -->
        <div class="chart-card">
            <h3>Puntuaci√≥n Promedio por Secci√≥n</h3>
            <canvas id="chart-secciones"></canvas>
        </div>

        <!-- Gr√°fico de Distribuci√≥n de Roles -->
        <div class="chart-card">
            <h3>Distribuci√≥n por Rol</h3>
            <canvas id="chart-roles"></canvas>
        </div>

        <!-- Gr√°fico de Evoluci√≥n Temporal -->
        <div class="chart-card full-width">
            <h3>Evoluci√≥n de Puntuaciones</h3>
            <canvas id="chart-evolucion"></canvas>
        </div>

        <!-- Gr√°fico de Preguntas Mejor/Peor Valoradas -->
        <div class="chart-card full-width">
            <h3>Preguntas Mejor y Peor Valoradas</h3>
            <canvas id="chart-preguntas"></canvas>
        </div>
    </div>

    <!-- Tabla de Encuestas -->
    <div class="table-section">
        <h3>Detalle de Encuestas</h3>
        <div class="table-container">
            <table id="tabla-encuestas">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Usuario</th>
                        <th>Rol</th>
                        <th>Fecha</th>
                        <th>Puntuaci√≥n</th>
                        <th>Promedio</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tbody-encuestas">
                    <!-- Los datos se cargan con JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal para Detalles -->
    <div id="modal-detalles" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Detalles de Encuesta</h2>
                <span class="close" onclick="cerrarModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-detalles-body">
                <!-- Contenido din√°mico -->
            </div>
        </div>
    </div>
</div>
<script>
    const VERENCUESTA_URL="{{ url_for('encuesta.VerEncuesta') }}"
    const VERENCUESTAID_URL="{{ url_for('encuesta.ObtenerEncuestaDetalle', encuesta_id=1)}}"
    const EXPORTARENCUESTA_URL="{{ url_for('encuesta.ExportarEncuesta') }}"
</script>
<!-- Incluir Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/gestionEncuesta.js') }}"></script>

{% endblock %}