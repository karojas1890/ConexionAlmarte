 {% extends "layout.html" %}

{% block title %}Agregar Tarjeta{% endblock %}

{% block content %} 
 
    <div class="container">
        <div class="header">
            <h1>üí≥ Administrar Tarjetas</h1>
            <p>Administra tus tarjetas de cr√©dito y d√©bito de forma segura</p>
        </div>
        <!-- Modal de confirmaci√≥n -->
        <div id="successModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <div class="modal-icon">‚úÖ</div>
                <h2></h2>
                <p></p>
            </div>
        </div>
       <div class="cards-list">
            <h2>üè¶ Mis Tarjetas</h2>
            <div id="cardsContainer">
     
            </div>
        </div>
        <div class="add-card-form">
            <h2>‚ûï Agregar Nueva Tarjeta</h2>

            <button type="button" class="btn-scan-card" onclick="openScanner()">
                <span style="font-size: 24px;">üì∑</span>
                Escanear Tarjeta con C√°mara
            </button>

            <div class="card-preview">
                <div class="preview-chip"></div>
                <div class="preview-number" id="previewNumber">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                <div class="preview-footer">
                    <div>
                        <div class="preview-label">Titular</div>
                        <div class="preview-value" id="previewHolder">NOMBRE COMPLETO</div>
                    </div>
                    <div>
                        <div class="preview-label">Vence</div>
                        <div class="preview-value" id="previewExpiry">MM/AA</div>
                    </div>
                </div>
            </div>

            <form id="cardForm" onsubmit="handleSubmit(event)">
               

                <div class="form-group input-icon">
                    <label for="cardNumber">N√∫mero de Tarjeta</label>
                    <input 
                        type="text" 
                        id="cardNumber" 
                        placeholder="1234 5678 9012 3456"
                        maxlength="19"
                        required
                        oninput="formatCardNumber(this); updatePreview()"
                    >
                    <span class="icon-card" id="cardIcon">üí≥</span>
                </div>

                <div class="form-group">
                    <label for="cardHolder">Nombre del Titular</label>
                    <input 
                        type="text" 
                        id="cardHolder" 
                        placeholder="Como aparece en la tarjeta"
                        required
                        oninput="this.value = this.value.toUpperCase(); updatePreview()"
                    >
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="expiryDate">Fecha de Expiraci√≥n</label>
                        <input 
                            type="text" 
                            id="expiryDate" 
                            placeholder="MM/AA"
                            maxlength="5"
                            required
                            oninput="formatExpiry(this); updatePreview()"
                        >
                    </div>
                    <div class="form-group">
                        <label for="cvv">CVV</label>
                        <input 
                            type="text" 
                            id="cvv" 
                            placeholder="123"
                            maxlength="4"
                            required
                            oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                        >
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="setDefault">
                    <label for="setDefault">Establecer como m√©todo de pago predeterminado</label>
                </div>

                <button type="submit" class="btn-submit">
                    Guardar Tarjeta
                </button>

                <div class="security-note">
                    <p><strong>üîí Tu informaci√≥n est√° segura</strong></p>
                    <p>Utilizamos encriptaci√≥n de nivel bancario para proteger tus datos. Nunca almacenamos tu CVV y toda la informaci√≥n se procesa de forma segura.</p>
                </div>
            </form>
        </div>
    </div>

    <div class="scanner-modal" id="scannerModal">
        <div class="scanner-container">
            <div class="scanner-header">
                <h3>üì∑ Escanear Tarjeta</h3>
                <button class="btn-close-scanner" onclick="closeScanner()">‚úï</button>
            </div>

            <div class="camera-view">
                <video id="cameraVideo" autoplay playsinline></video>
                <div class="camera-overlay"></div>
                <div class="camera-instructions">
                    Coloca tu tarjeta dentro del marco
                </div>
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="spinner"></div>
                    <p style="color: #5BA8A0; font-weight: 600;">Procesando imagen...</p>
                </div>
            </div>

            <canvas id="captureCanvas" class="canvas-hidden"></canvas>

            <div class="scanner-actions">
                <button class="btn-scanner btn-cancel" onclick="closeScanner()">Cancelar</button>
                <button class="btn-scanner btn-capture" onclick="captureCard()">Capturar</button>
            </div>
        </div>
    </div>

     <script>
    const SCANCARD_URL = "{{ url_for('card.ScanCard') }}";
    const ADDCARD_URL = "{{ url_for('card.AddCard') }}";
   </script>
  
    <script src="{{ url_for('static', filename='js/addCard.js') }}"></script>
{% endblock %} 